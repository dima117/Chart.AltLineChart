(function(g,f){"function"===typeof define&&define.amd?define(["Chart"],f):"object"===typeof exports?f(require("Chart")):f(g.Chart)})(this,function(g){var f=g.helpers,l={formatDateValue:function(a,b,c,d){a=new Date(+a);var e=d?a.getUTCMilliseconds():a.getMilliseconds();return e?("000"+e).slice(-3):(d?a.getUTCHours()+a.getUTCMinutes()+a.getUTCSeconds():a.getHours()+a.getMinutes()+a.getSeconds())?p(a,b||"h:MM",d):p(a,c||"mmm d",d)},getElementOrDefault:function(a,b,c){return 0<=b&&b<a.length?a[b]:c},
applyRange:function(a,b,c){return a>c?c:a<b?b:a},ScatterPoint:g.Point.extend({inRange:function(a,b){var c=this.hitDetectionRadius+this.radius*this.size;return Math.pow(a-this.x,2)+Math.pow(b-this.y,2)<Math.pow(c,2)},draw:function(){if(this.display&&0<this.size){var a=this.ctx;a.beginPath();a.arc(this.x,this.y,this.size*this.radius,0,2*Math.PI);a.closePath();a.strokeStyle=this.strokeColor;a.lineWidth=this.strokeWidth;a.fillStyle=this.fillColor;a.fill();a.stroke()}}})},p=function(){var a=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,
b=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,c=/[^-+\dA-Z]/g,d=function(a,b){a=String(a);for(b=b||2;a.length<b;)a="0"+a;return a},e={"default":"ddd mmm dd yyyy HH:MM:ss"},q="Sun Mon Tue Wed Thu Fri Sat Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),f="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec January February March April May June July August September October November December".split(" ");
return function(h,g,r){1!=arguments.length||"[object String]"!=Object.prototype.toString.call(h)||/\d/.test(h)||(g=h,h=void 0);h=h?new Date(h):new Date;if(isNaN(h))throw SyntaxError("invalid date");g=String(e[g]||g||e["default"]);"UTC:"==g.slice(0,4)&&(g=g.slice(4),r=!0);var m=r?"getUTC":"get",l=h[m+"Date"](),p=h[m+"Day"](),t=h[m+"Month"](),v=h[m+"FullYear"](),n=h[m+"Hours"](),w=h[m+"Minutes"](),x=h[m+"Seconds"](),m=h[m+"Milliseconds"](),u=r?0:h.getTimezoneOffset(),y={d:l,dd:d(l),ddd:q[p],dddd:q[p+
7],m:t+1,mm:d(t+1),mmm:f[t],mmmm:f[t+12],yy:String(v).slice(2),yyyy:v,h:n%12||12,hh:d(n%12||12),H:n,HH:d(n),M:w,MM:d(w),s:x,ss:d(x),l:d(m,3),L:d(99<m?Math.round(m/10):m),t:12>n?"a":"p",tt:12>n?"am":"pm",T:12>n?"A":"P",TT:12>n?"AM":"PM",Z:r?"UTC":(String(h).match(b)||[""]).pop().replace(c,""),o:(0<u?"-":"+")+d(100*Math.floor(Math.abs(u)/60)+Math.abs(u)%60,4),S:["th","st","nd","rd"][3<l%10?0:(10!=l%100-l%10)*l%10]};return g.replace(a,function(a){return a in y?y[a]:a.slice(1,a.length-1)})}}();g.ScatterNumberScale=
g.Element.extend({initialize:function(){this.font=f.fontString(this.fontSize,this.fontStyle,this.fontFamily);this.padding=this.fontSize/2},setDataRange:function(a){this.dataRange=a},api:{calculateControlPoints:function(a,b,c,d,e){var f=a?e:0;e=c?e:0;var k=a?a:b;a=c?c:b;c=a.arg-k.arg;a=a.value-k.value;var k=(b.arg-k.arg)*c+(b.value-k.value)*a,h=Math.sqrt(c*c+a*a),k=Math.min(Math.max(k/(h*h),.3),.7);b={before:{x:b.arg-c*k*f,y:b.value-a*k*f},after:{x:b.arg+c*(1-k)*e,y:b.value+a*(1-k)*e}};b.before.y=
l.applyRange(b.before.y,d.ymin,d.ymax);b.after.y=l.applyRange(b.after.y,d.ymin,d.ymax);return b},generateLabels:function(a,b,c,d){var e=Array(b+1),q=f.getDecimalPlaces(d);a&&f.each(e,function(b,h){e[h]=f.template(a,{value:(c+d*h).toFixed(q)})});return e}},calculateYscaleRange:function(){this.yScaleRange=this.scaleOverride?{steps:this.scaleSteps,stepValue:this.scaleStepWidth,min:this.scaleStartValue,max:this.scaleStartValue+this.scaleSteps*this.scaleStepWidth}:f.calculateScaleRange([this.dataRange.ymin,
this.dataRange.ymax],this.chart.height,this.fontSize,this.beginAtZero,this.integersOnly)},calculateXscaleRange:function(){this.xScaleRange=f.calculateScaleRange([this.dataRange.xmin,this.dataRange.xmax],this.chart.width,this.fontSize,!1,!0)},generateYLabels:function(){this.yLabels=this.api.generateLabels(this.labelTemplate,this.yScaleRange.steps,this.yScaleRange.min,this.yScaleRange.stepValue)},generateXLabels:function(){this.xLabels=this.api.generateLabels(this.argLabelTemplate,this.xScaleRange.steps,
this.xScaleRange.min,this.xScaleRange.stepValue)},argToString:function(a){return+a+""},fit:function(){this.calculateYscaleRange();this.calculateXscaleRange();this.generateYLabels();this.generateXLabels();var a=f.longestText(this.chart.ctx,this.font,this.xLabels),b=f.longestText(this.chart.ctx,this.font,this.yLabels);this.xPadding=this.display&&this.showLabels?b+2*this.padding:this.padding;b=1.5*this.fontSize;this.xLabelRotation=a>Math.floor((this.chart.width-this.xPadding)/this.xScaleRange.steps);
this.xPaddingRight=this.display&&this.showLabels&&!this.xLabelRotation?a/2:this.padding;this.yPadding=this.display&&this.showLabels?(this.xLabelRotation?a:b)+2*this.padding:this.padding},updateBezierControlPoints:function(a,b,c){for(var d=0;d<a.length;d++){var e=l.getElementOrDefault(a,d),f=l.getElementOrDefault(a,d-1),k=l.getElementOrDefault(a,d+1),f=this.api.calculateControlPoints(f,e,k,this.dataRange,c);e.controlPoints={x1:this.calculateX(f.before.x),y1:this.calculateY(f.before.y,b),x2:this.calculateX(f.after.x),
y2:this.calculateY(f.after.y,b)}}},updatePoints:function(a,b){for(var c=0;c<a.length;c++){var d=a[c];d.x=this.calculateX(d.arg);d.y=this.calculateY(d.value,b)}},calculateX:function(a){return this.xPadding+(a-this.xScaleRange.min)*(this.chart.width-this.xPadding-this.xPaddingRight)/(this.xScaleRange.max-this.xScaleRange.min)},calculateY:function(a,b){return this.chart.height-this.yPadding-(a-this.yScaleRange.min)*(this.chart.height-this.yPadding-this.padding)/(this.yScaleRange.max-this.yScaleRange.min)*
(b||1)},draw:function(){var a=this.chart.ctx,b,c;if(this.display){var d=this.calculateX(this.xScaleRange.min),e=this.chart.width,f=this.calculateY(this.yScaleRange.min);c=0;for(b=this.yScaleRange.min;c<=this.yScaleRange.steps;c++,b+=this.yScaleRange.stepValue){var k=this.calculateY(b);if(this.showLabels||this.showHorizontalLines)a.lineWidth=0==c?this.lineWidth:this.gridLineWidth,a.strokeStyle=0==c?this.lineColor:this.gridLineColor,a.beginPath(),a.moveTo(d-this.padding,k),a.lineTo(this.showHorizontalLines||
0==c?e:d,k),a.stroke();this.showLabels&&(a.lineWidth=this.lineWidth,a.strokeStyle=this.lineColor,a.textAlign="right",a.textBaseline="middle",a.font=this.font,a.fillStyle=this.textColor,a.fillText(this.yLabels[c],d-1.4*this.padding,k))}c=0;for(b=this.xScaleRange.min;c<=this.xScaleRange.steps;c++,b+=this.xScaleRange.stepValue){d=this.calculateX(b);if(this.showLabels||this.showVerticalLines)a.lineWidth=0==c?this.lineWidth:this.gridLineWidth,a.strokeStyle=0==c?this.lineColor:this.gridLineColor,a.beginPath(),
a.moveTo(d,f+this.padding),a.lineTo(d,this.showVerticalLines||0==c?0:f),a.stroke();this.showLabels&&(a.lineWidth=this.lineWidth,a.strokeStyle=this.lineColor,a.save(),a.translate(d,f+1.4*this.padding),a.rotate(this.xLabelRotation?-Math.PI/2:0),a.textAlign=this.xLabelRotation?"right":"center",a.textBaseline=this.xLabelRotation?"middle":"top",a.font=this.font,a.fillStyle=this.textColor,a.fillText(this.xLabels[c],0,0),a.restore())}}}});g.ScatterDateScale=g.ScatterNumberScale.extend({_calculateDateScaleRange:function(a,
b,c,d){var e=[{u:1,c:1,t:1,n:"ms"},{u:1,c:2,t:2,n:"ms"},{u:1,c:5,t:5,n:"ms"},{u:1,c:10,t:10,n:"ms"},{u:1,c:20,t:20,n:"ms"},{u:1,c:50,t:50,n:"ms"},{u:1,c:100,t:100,n:"ms"},{u:1,c:200,t:200,n:"ms"},{u:1,c:500,t:500,n:"ms"},{u:1E3,c:1,t:1E3,n:"s"},{u:1E3,c:2,t:2E3,n:"s"},{u:1E3,c:5,t:5E3,n:"s"},{u:1E3,c:10,t:1E4,n:"s"},{u:1E3,c:15,t:15E3,n:"s"},{u:1E3,c:20,t:2E4,n:"s"},{u:1E3,c:30,t:3E4,n:"s"},{u:6E4,c:1,t:6E4,n:"m"},{u:6E4,c:2,t:12E4,n:"m"},{u:6E4,c:5,t:3E5,n:"m"},{u:6E4,c:10,t:6E5,n:"m"},{u:6E4,c:15,
t:9E5,n:"m"},{u:6E4,c:20,t:12E5,n:"m"},{u:6E4,c:30,t:18E5,n:"m"},{u:36E5,c:1,t:36E5,n:"h"},{u:36E5,c:2,t:72E5,n:"h"},{u:36E5,c:3,t:108E5,n:"h"},{u:36E5,c:4,t:144E5,n:"h"},{u:36E5,c:6,t:216E5,n:"h"},{u:36E5,c:8,t:288E5,n:"h"},{u:36E5,c:12,t:432E5,n:"h"},{u:864E5,c:1,t:864E5,n:"d"},{u:864E5,c:2,t:1728E5,n:"d"},{u:864E5,c:4,t:3456E5,n:"d"},{u:864E5,c:5,t:432E6,n:"d"},{u:6048E5,c:1,t:6048E5,n:"w"}];d=c/(3.3*d);var f=+b-a;c=this.useUtc?0:6E4*(new Date).getTimezoneOffset();a=+a-c;b=+b-c;for(var k=0,h=[2,
3,5,7,10];f/e[k].t>d;)if(k++,k==e.length)for(var g=e[e.length-1],l=0;l<h.length;l++)e.push({u:g.u,c:g.c*h[l],t:g.c*h[l]*g.u,n:g.n});e=e[k].t;d=Math.floor(a/e)*e;f=Math.ceil((b-d)/e);return{min:d+c,max:d+e*f+c,steps:f,stepValue:e}},calculateXscaleRange:function(){this.xScaleRange=this._calculateDateScaleRange(this.dataRange.xmin,this.dataRange.xmax,this.chart.width,this.fontSize)},argToString:function(a){return p(+a,this.dateTimeFormat,this.useUtc)},generateXLabels:function(){var a=this.xScaleRange.min,
b=this.xScaleRange.stepValue,c=Array(this.xScaleRange.steps+1);f.each(c,function(d,e){c[e]=l.formatDateValue(a+b*e,this.timeFormat,this.dateFormat,this.useUtc)},this);this.xLabels=c}});g.ScatterDataSet=function(){var a=function(a,c,d,e){this.chart=d;this.scale=e;this.label=a.label||null;this.strokeColor=a.strokeColor||c.datasetStrokeColor;this.pointColor=a.pointColor||a.strokeColor||c.datasetStrokeColor;this.pointStrokeColor=a.pointStrokeColor||c.datasetPointStrokeColor;this.strokeWidth=a.strokeWidth||
c.datasetStrokeWidth;this.pointDot=c.pointDot;this.pointDotRadius=c.pointDotRadius;this.pointHitDetectionRadius=c.pointHitDetectionRadius;this.pointDotStrokeWidth=c.pointDotStrokeWidth;this.scaleArgLabel=c.scaleArgLabel;this.scaleLabel=c.scaleLabel;this.scaleSizeLabel=c.scaleSizeLabel;this.points=[]};a.prototype.addPoint=function(a,c,d){d=3>arguments.length?1:d;var e=this._createNewPoint();this._setPointData(e,a,c,d);this.points.push(e)};a.prototype.setPointData=function(a,c,d,e){e=4>arguments.length?
1:e;var f=l.getElementOrDefault(this.points,a);f&&this._setPointData(f,c,d,e)};a.prototype.removePoint=function(a){0<=a&&a<this.points.length&&this.points.splice(a,1)};a.prototype._createNewPoint=function(){return new l.ScatterPoint({ctx:this.chart.ctx,datasetLabel:this.label,display:this.pointDot,radius:this.pointDotRadius,hitDetectionRadius:this.pointHitDetectionRadius,strokeWidth:this.pointDotStrokeWidth,strokeColor:this.pointStrokeColor,highlightStroke:this.pointColor,fillColor:this.pointColor,
highlightFill:this.pointStrokeColor})};a.prototype._setPointData=function(a,c,d,e){var g=this.scale.argToString(+c),k=+d+"",h=+e+"";a.arg=+c;a.value=+d;a.size=+e;a.argLabel=f.template(this.scaleArgLabel,{value:g});a.valueLabel=f.template(this.scaleLabel,{value:k});a.sizeLabel=f.template(this.scaleSizeLabel,{value:h})};return a}();g.Type.extend({name:"Scatter",defaults:{scaleArgLabel:"<%=value%>",scaleSizeLabel:"<%=value%>",emptyDataMessage:"chart has no data",scaleShowGridLines:!0,scaleGridLineWidth:1,
scaleGridLineColor:"rgba(0,0,0,.05)",scaleShowHorizontalLines:!0,scaleShowVerticalLines:!0,scaleType:"number",useUtc:!0,scaleDateFormat:"mmm d",scaleTimeFormat:"h:MM",scaleDateTimeFormat:"mmm d, yyyy, hh:MM",datasetStroke:!0,datasetStrokeWidth:0,datasetStrokeColor:"#007ACC",datasetPointStrokeColor:"white",bezierCurve:!0,bezierCurveTension:.4,pointDot:!0,pointDotStrokeWidth:1,pointDotRadius:4,pointHitDetectionRadius:4,multiTooltipTemplate:"<%=argLabel%>; <%=valueLabel%>",tooltipTemplate:"<%if (datasetLabel){%><%=datasetLabel%>: <%}%><%=argLabel%>; <%=valueLabel%>",
legendTemplate:'<ul class="<%=name.toLowerCase()%>-legend"><%for(var i=0;i<datasets.length;i++){%><li><span class="<%=name.toLowerCase()%>-legend-marker" style="background-color:<%=datasets[i].strokeColor%>"></span><%=datasets[i].label%></li><%}%></ul>'},initialize:function(a){this.hasData=!1;this.datasets=[];this.scale=this._initScale();a.datasets&&(a=a.datasets);f.each(a,function(a){var c=new g.ScatterDataSet(a,this.options,this.chart,this.scale);this.datasets.push(c);this.hasData|=!!a.data.length;
f.each(a.data,function(a){c.addPoint(a.x,a.y,a.r||1)})},this);this.options.showTooltips&&f.bindEvents(this,this.options.tooltipEvents,function(a){a="mouseout"!==a.type?this.getPointsAtEvent(a):[];this._forEachPoint(function(a){a.restore(["fillColor","strokeColor"])});f.each(a,function(a){a.fillColor=a.highlightFill;a.strokeColor=a.highlightStroke});this.showTooltip(a)});a=this._calculateRange();this.scale.setDataRange(a);this.update()},_initScale:function(){var a={chart:this.chart,textColor:this.options.scaleFontColor,
fontSize:this.options.scaleFontSize,fontStyle:this.options.scaleFontStyle,fontFamily:this.options.scaleFontFamily,labelTemplate:this.options.scaleLabel,argLabelTemplate:this.options.scaleArgLabel,showLabels:this.options.scaleShowLabels,beginAtZero:this.options.scaleBeginAtZero,integersOnly:this.options.scaleIntegersOnly,gridLineWidth:this.options.scaleShowGridLines?this.options.scaleGridLineWidth:0,gridLineColor:this.options.scaleShowGridLines?this.options.scaleGridLineColor:"rgba(0,0,0,0)",showHorizontalLines:this.options.scaleShowHorizontalLines,
showVerticalLines:this.options.scaleShowVerticalLines,lineWidth:this.options.scaleLineWidth,lineColor:this.options.scaleLineColor,display:this.options.showScale,scaleOverride:this.options.scaleOverride,scaleSteps:this.options.scaleSteps,scaleStepWidth:this.options.scaleStepWidth,scaleStartValue:this.options.scaleStartValue,useUtc:this.options.useUtc,dateFormat:this.options.scaleDateFormat,timeFormat:this.options.scaleTimeFormat,dateTimeFormat:this.options.scaleDateTimeFormat};return"date"===this.options.scaleType?
new g.ScatterDateScale(a):new g.ScatterNumberScale(a)},getPointsAtEvent:function(a){var b=[],c=f.getRelativePosition(a);f.each(this.datasets,function(a){f.each(a.points,function(a){a.inRange(c.x,c.y)&&b.push(a)})},this);return b},showTooltip:function(a){this.draw();if(0<a.length){var b=a[0],c=b.tooltipPosition();if(1==a.length)(new g.Tooltip({x:Math.round(c.x),y:Math.round(c.y),xPadding:this.options.tooltipXPadding,yPadding:this.options.tooltipYPadding,fillColor:this.options.tooltipFillColor,textColor:this.options.tooltipFontColor,
fontFamily:this.options.tooltipFontFamily,fontStyle:this.options.tooltipFontStyle,fontSize:this.options.tooltipFontSize,caretHeight:this.options.tooltipCaretSize,cornerRadius:this.options.tooltipCornerRadius,text:f.template(this.options.tooltipTemplate,b),chart:this.chart,custom:this.options.customTooltips})).draw();else{var d=[],e=[];f.each(a,function(a){d.push(f.template(this.options.multiTooltipTemplate,a));e.push({fill:a._saved.fillColor||a.fillColor,stroke:a._saved.strokeColor||a.strokeColor})},
this);(new Chart.MultiTooltip({x:Math.round(c.x),y:Math.round(c.y),xPadding:this.options.tooltipXPadding,yPadding:this.options.tooltipYPadding,xOffset:this.options.tooltipXOffset,fillColor:this.options.tooltipFillColor,textColor:this.options.tooltipFontColor,fontFamily:this.options.tooltipFontFamily,fontStyle:this.options.tooltipFontStyle,fontSize:this.options.tooltipFontSize,titleTextColor:this.options.tooltipTitleFontColor,titleFontFamily:this.options.tooltipTitleFontFamily,titleFontStyle:this.options.tooltipTitleFontStyle,
titleFontSize:this.options.tooltipTitleFontSize,cornerRadius:this.options.tooltipCornerRadius,labels:d,legendColors:e,legendColorBackground:this.options.multiTooltipKeyBackground,title:"",chart:this.chart,ctx:this.chart.ctx,custom:this.options.customTooltips})).draw()}}return this},_forEachPoint:function(a){f.each(this.datasets,function(b){f.each(b.points,a,this)},this)},_forEachDataset:function(a){f.each(this.datasets,a,this)},_calculateRange:function(){var a=void 0,b=void 0,c=void 0,d=void 0;this._forEachPoint(function(e){if(void 0===
a||e.arg<a)a=e.arg;if(void 0===b||e.arg>b)b=e.arg;if(void 0===c||e.value<c)c=e.value;if(void 0===d||e.value>d)d=e.value});return{xmin:a,xmax:b,ymin:c,ymax:d}},_drawMessage:function(a){var b=this.chart.ctx,c=this.chart.width,d=this.chart.height,e=f.fontString(this.options.scaleFontSize,this.options.scaleFontStyle,this.options.scaleFontFamily);b.save();b.translate(c/2,d/2);b.textAlign="center";b.textBaseline="middle";b.font=e;b.fillStyle=this.options.scaleFontColor;b.fillText(a,0,0);b.restore()},_drawLine:function(a){var b=
this.chart.ctx,c=void 0;0!=a.strokeWidth&&(b.lineJoin="round",b.lineWidth=a.strokeWidth||this.options.datasetStrokeWidth,b.strokeStyle=a.strokeColor||this.options.datasetStrokeColor,b.beginPath(),f.each(a.points,function(a,e){0===e?b.moveTo(a.x,a.y):this.options.bezierCurve?b.bezierCurveTo(c.controlPoints.x2,c.controlPoints.y2,a.controlPoints.x1,a.controlPoints.y1,a.x,a.y):b.lineTo(a.x,a.y);c=a},this),b.stroke())},update:function(){var a=this._calculateRange();this.scale.setDataRange(a);this.render()},
draw:function(a){this.hasData?(this.scale.fit(),this._forEachDataset(function(b){this.scale.updatePoints(b.points,a);this.options.bezierCurve&&this.scale.updateBezierControlPoints(b.points,a,this.options.bezierCurveTension)}),this.clear(),this.scale.draw(),this.options.datasetStroke&&f.each(this.datasets,this._drawLine,this),this.options.pointDot&&this._forEachPoint(function(a){a.draw()})):(this.clear(),this._drawMessage(this.options.emptyDataMessage))}})});
